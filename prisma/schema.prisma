// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Profissional {
  id                String     @id @default(cuid())
  nome              String
  email             String     @unique
  telefone          String?
  especialidade     String
  valorHora         Float?     // Opcional agora (pode ser null para contratos fechados)
  status            String     @default("ativo") // ativo, inativo, ferias
  dataAdmissao      String
  tipoContrato      String     @default("hora") // hora, fechado
  valorFechado      Float?     // Valor do contrato fechado
  periodoFechado    String?    // mensal, trimestral, semestral, anual
  valorPago         Float      // Valor pago ao profissional
  percentualImpostos Float     @default(13.0) // Percentual padrão de impostos
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt

  // Relacionamentos
  contratos         Contrato[]

  @@map("profissionais")
}

model Cliente {
  id          String     @id @default(cuid())
  nome        String
  empresa     String
  email       String     @unique
  telefone    String?
  endereco    String?
  anoInicio   Int        // Ano de início do relacionamento com a Matilha
  segmento    String     // Segmento de atuação
  tamanho     String     @default("Média") // Pequena, Média, Grande
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  // Relacionamentos
  contratos   Contrato[]

  @@map("clientes")
}

model Contrato {
  id                 String   @id @default(cuid())
  profissionalId     String
  clienteId          String
  dataInicio         String
  dataFim            String
  tipoContrato       String   @default("hora") // hora, fechado
  valorHora          Float?   // Opcional (apenas para contratos por hora)
  horasMensais       Int?     // Opcional (apenas para contratos por hora)
  valorFechado       Float?   // Opcional (apenas para contratos fechados)
  periodoFechado     String?  // Opcional (apenas para contratos fechados)
  status             String   @default("ativo") // ativo, encerrado, pendente
  valorTotal         Float
  valorRecebido      Float
  valorPago          Float
  percentualImpostos Float    @default(13.0) // Percentual específico do contrato
  valorImpostos      Float    // Valor calculado dos impostos
  margemLucro        Float    // Rentabilidade (valorRecebido - valorImpostos - valorPago)
  observacoes        String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  // Relacionamentos
  profissional       Profissional @relation(fields: [profissionalId], references: [id], onDelete: Cascade)
  cliente            Cliente      @relation(fields: [clienteId], references: [id], onDelete: Cascade)

  @@map("contratos")
}
